<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Textify Admin Dashboard</title>
<style>
body{margin:0;font-family:Inter,system-ui,sans-serif;background:#0f172a;color:#f1f5f9;min-height:100vh;padding:1rem;}
h1{font-size:1.5rem;margin-bottom:1rem;background:linear-gradient(90deg,#818cf8,#c084fc);-webkit-background-clip:text;color:transparent;}
input,button,select{font-family:inherit;}
input{background:#1e293b;color:white;border:1px solid #334155;border-radius:0.5rem;padding:0.5rem;}
button{cursor:pointer;padding:0.5rem 1rem;border:none;border-radius:0.5rem;font-weight:600;color:white;}
button:hover{opacity:0.9;}
.section{background:#1e293b;padding:1rem;border-radius:0.75rem;margin-bottom:1rem;}
.grid{display:grid;gap:1rem;}
.text-muted{color:#94a3b8;font-size:0.9rem;}
#logs{max-height:300px;overflow:auto;font-size:0.8rem;background:#0f172a;border-radius:0.5rem;padding:0.5rem;}
.log-entry{border-bottom:1px solid #334155;padding:0.5rem 0;}
</style>
</head>
<body>
<h1>Textify Admin Dashboard</h1>
<div class="section" id="connectBox">
  <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
    <input id="serverUrl" placeholder="Server URL (e.g. http://localhost:3000)" value="http://localhost:3000" style="flex:1;"/>
    <input id="adminKey" placeholder="Admin key (ADMIN123)" value="ADMIN123"/>
    <button id="connectBtn" style="background:#4f46e5;">Connect</button>
  </div>
  <p class="text-muted" style="margin-top:0.5rem;">You can open this file directly in browser or through the server. Enter correct server URL and key.</p>
</div>

<div id="dashboard" class="hidden">
  <div class="section">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div><div class="text-muted">Active Clients</div><div id="activeCount" style="font-size:2rem;font-weight:700;">0</div></div>
      <div>
        <button id="refreshBtn" style="background:#475569;">Refresh</button>
        <button id="reloadBadwords" style="background:#f59e0b;margin-left:0.5rem;">Reload Badwords</button>
      </div>
    </div>
  </div>

  <div class="section">
    <h2 style="margin-bottom:0.5rem;">Active Pairs</h2>
    <div id="pairsList" class="text-muted">Loading...</div>
  </div>

  <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(300px,1fr));">
    <div class="section">
      <h3>Abuse Logs</h3>
      <div id="logs"></div>
    </div>
    <div class="section">
      <h3>Actions</h3>
      <div style="display:flex;flex-direction:column;gap:0.5rem;">
        <input id="banId" placeholder="Client ID to ban">
        <button id="banIdBtn" style="background:#dc2626;">Ban ID</button>
        <input id="banIp" placeholder="IP to ban">
        <button id="banIpBtn" style="background:#dc2626;">Ban IP</button>
      </div>
    </div>
  </div>
</div>
<div id="status" class="text-muted" style="margin-top:1rem;"></div>

<script>
const serverUrlInput=document.getElementById('serverUrl');
const adminKeyInput=document.getElementById('adminKey');
const connectBtn=document.getElementById('connectBtn');
const dashboard=document.getElementById('dashboard');
const statusEl=document.getElementById('status');
const activeCountEl=document.getElementById('activeCount');
const pairsList=document.getElementById('pairsList');
const logsEl=document.getElementById('logs');
const refreshBtn=document.getElementById('refreshBtn');
const reloadBadwords=document.getElementById('reloadBadwords');
const banIdBtn=document.getElementById('banIdBtn');
const banIpBtn=document.getElementById('banIpBtn');
const banId=document.getElementById('banId');
const banIp=document.getElementById('banIp');
let SERVER='',KEY='';

function msg(s){statusEl.textContent=s;}

async function connect(){
  SERVER=serverUrlInput.value.trim().replace(/\/$/,'');
  KEY=adminKeyInput.value.trim();
  if(!SERVER||!KEY){msg('Enter valid URL and key');return;}
  dashboard.classList.remove('hidden');
  await refresh();
  msg('Connected to '+SERVER);
}
connectBtn.onclick=connect;

async function refresh(){
  try{
    const s=await fetch(SERVER+'/admin/stats?key='+encodeURIComponent(KEY));
    if(!s.ok)throw new Error('Stats failed');
    const j=await s.json();
    activeCountEl.textContent=j.activeClientCount||0;
    pairsList.innerHTML=j.pairs?.length?j.pairs.map(p=>`<div>${p.id} â†” ${p.partner} (${p.mode})</div>`).join(''):'No pairs';
    const l=await fetch(SERVER+'/admin/logs?key='+encodeURIComponent(KEY));
    const logs=await l.json();
    logsEl.innerHTML=logs.logs?.length?logs.logs.slice().reverse().map(e=>`<div class='log-entry'><div>${new Date(e.ts).toLocaleString()}</div><div>${escape(JSON.stringify(e))}</div></div>`).join(''):'No logs';
  }catch(e){msg(e.message);}
}
refreshBtn.onclick=refresh;
reloadBadwords.onclick=async()=>{
  try{
    const r=await fetch(SERVER+'/admin/reload-badwords',{method:'POST',headers:{'x-admin-key':KEY}});
    msg('Reloaded badwords');
  }catch(e){msg('Reload failed');}
};
banIdBtn.onclick=()=>ban({id:banId.value});
banIpBtn.onclick=()=>ban({ip:banIp.value});
async function ban(data){
  try{
    await fetch(SERVER+'/admin/ban',{method:'POST',headers:{'Content-Type':'application/json','x-admin-key':KEY},body:JSON.stringify(data)});
    msg('Ban sent');
  }catch(e){msg('Ban failed');}
}
function escape(s){return s.replace(/[&<>]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));}
</script>
</body>
</html>
